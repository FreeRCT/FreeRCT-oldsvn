\documentclass{article}
% $Id$
% This file is part of FreeRCT.
% FreeRCT is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, version 2.
% FreeRCT is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
% See the GNU General Public License for more details. You should have received a copy of the GNU General Public License along with FreeRCT. If not, see <http://www.gnu.org/licenses/>.
%
\usepackage[a4paper]{geometry}
\title{File format of the \texttt{$*$.rcd} data files}
\author{Alberth}
\date{Built \today}

\begin{document}
\maketitle

%%
%%
%%
\section{File header}
Each data file starts with a file header indicating it is a RCD{} file.
The format is as follows

\begin{center}
\begin{tabular}{|r|c|l|} \hline
\textbf{Offset} & \textbf{Length} & \textbf{Contents description} \\ \hline
0 & 4 & Magic string `RCDF' \\
4 & 4 & Value `1', version number of the data file format. \\ \hline
8 & \multicolumn{2}{l|}{Total length} \\ \hline
\end{tabular}
\end{center}

%%
%%
%%
\section{Data blocks}
After the file header come the various data blocks.
The goal of data blocks is to provide blobs of information that are somewhat independent.
The data blocks are referenced by game blocks by their ID. The first data block
gets number 1, the second block number 2, etc.

A reference to data block 0 means `not present'.


\subsection{Sprite Pixels}
A data block containing the actual image of a sprite (in 8bpp).

\begin{center}
\begin{tabular}{|r|c|l|} \hline
\textbf{Offset} & \textbf{Length} & \textbf{Contents description} \\ \hline
 0 & 4 & Magic string `8PXL' \\
 4 & 4 & Version number of the block `1'. \\
 8 & 4 & Length of the block excluding magic string, version, and length. \\
12 & 2 & Width of the image. \\
14 & 2 & $h$, height of the image. \\
16 & $4*h$ & Jump table to pixel data of each line. Offset is relative to the first \\
   &       & entry of the jump table. Value 0 means there is no data for that line. \\
 ? &    ?  & Pixels of each line. \\ \hline
 ? & \multicolumn{2}{l|}{Variable length} \\ \hline
\end{tabular}
\end{center}

Line data is a sequence of pixels with an offset. Its format is

\begin{center}
\begin{tabular}{|r|c|l|} \hline
\textbf{Offset} & \textbf{Length} & \textbf{Contents description} \\ \hline
 0 & 1 & Relative offset (0-127), bit 7 means `last entry of the line'. \\
 1 & 1 & $n$, number of pixels that follow this count (0-255). \\
 2 & $n$ & Pixels, 1 byte per pixel (as it is 8bpp). \\ \hline
 ? & \multicolumn{2}{l|}{Variable length} \\ \hline
\end{tabular}
\end{center}

The offset byte is relative to the end of the previous pixels, thus an offset
of 0 means no gap between the pixels. A count of 0 is useful if the gap at a
line is longer than 127 pixels.

\medskip
Note: Some simple form of compressing may be useful in the pixels as it
decreases the amount of memory transfers.


\subsection{Sprite block}
Data of a single sprite.

\begin{center}
\begin{tabular}{|r|c|l|} \hline
\textbf{Offset} & \textbf{Length} & \textbf{Contents description} \\ \hline
   0 &  4 & Magic string `SPRT' \\
   4 &  4 & Version number of the block `2'. \\
   8 &  4 & Length of the block excluding magic string, version, and length. \\
  12 &  2 & (signed) X-offset. \\
  14 &  2 & (signed) Y-offset. \\
  16 &  4 & Sprite image data. \\
  20 &  0 & (removed in version 2) Palette data. \\ \hline
  20 & \multicolumn{2}{l|}{Total length} \\ \hline
\end{tabular}
\end{center}


\section{Game blocks}
A game block is a piece of data useful for the game. Normally it refers to one
or more data blocks.

\subsection{Tile surface sprite sub-block}
In several game blocks you can find a set of sprite for the ground. Below is
the layout of such a sub-block.
Note that the sprites should look to the north (thus, the sprite at 4 has its
back corner up).

\begin{center}
\begin{tabular}{|r|c|l|} \hline
\textbf{Offset} & \textbf{Length} & \textbf{Contents description} \\ \hline
   0 &  4 & Flat surface tile. \\
   4 &  4 & North corner up. \\
   8 &  4 & East corner up. \\
  12 &  4 & North, east corners up. \\
  16 &  4 & South corner up. \\
  20 &  4 & North, south corners up. \\
  24 &  4 & East, south corners up. \\
  28 &  4 & North, east, south corners up. \\
  32 &  4 & West, north corners up. \\
  36 &  4 & West, east corners up. \\
  40 &  4 & West, north, east corners up. \\
  44 &  4 & West, south corners up. \\
  48 &  4 & West, north, south corners up. \\
  52 &  4 & West, east, south corners up. \\
  56 &  4 & Steep north slope. \\
  60 &  4 & Steep east slope. \\
  64 &  4 & Steep south slope. \\
  68 &  4 & Steep west slope. \\ \hline
  72 & \multicolumn{2}{l|}{Total length of the sub-block} \\ \hline
\end{tabular}
\end{center}


\subsection{Ground tiles block}
A set of ground tiles that form a smooth surface.

\begin{center}
\begin{tabular}{|r|c|l|} \hline
\textbf{Offset} & \textbf{Length} & \textbf{Contents description} \\ \hline
   0 &  4 & Magic string `SURF' \\
   4 &  4 & Version number of the block `3'. \\
   8 &  4 & Length of the block excluding magic string, version, and length. \\
  12 &  2 & (added in version 2) Type of ground. \\
  14 &  2 & Width of a tile of the surface. \\
  16 &  2 & Change in Z height (in pixels) when going up or down a tile level. \\
  18 & 72 & Tile surface sprite sub-block for north viewing direction. \\
  90 &  0 & (removed in version 3) Tile surface sprite sub-block for east viewing direction. \\
  90 &  0 & (removed in version 3) Tile surface sprite sub-block for south viewing direction. \\
  90 &  0 & (removed in version 3) Tile surface sprite sub-block for west viewing direction. \\ \hline
  90 & \multicolumn{2}{l|}{Total length} \\ \hline
\end{tabular}
\end{center}

\medskip
\noindent
Known types of ground:
\begin{itemize}
\item Empty (0) Reserved, do not use in the RCD{} file.
\item Grass (16-19) Green grass ground, with increasing length grass on it.
\item Sand  (32) Desert `ground'.
\end{itemize}

%%
%%
%%
\subsection{Tile selection}
A tile selection cursor. It is very similar to ground tiles, except there is
no type.

\begin{center}
\begin{tabular}{|r|c|l|} \hline
\textbf{Offset} & \textbf{Length} & \textbf{Contents description} \\ \hline
   0 &  4 & Magic string `TSEL' \\
   4 &  4 & Version number of the block `1'. \\
   8 &  4 & Length of the block excluding magic string, version, and length. \\
  12 &  2 & Width of a tile of the surface. \\
  14 &  2 & Change in Z height (in pixels) when going up or down a tile level. \\
  16 & 72 & Tile surface sprite sub-block. \\ \hline
  88 & \multicolumn{2}{l|}{Total length} \\ \hline
\end{tabular}
\end{center}

\subsection{Tile area selection}
\begin{center}
\begin{tabular}{|r|c|l|} \hline
\textbf{Offset} & \textbf{Length} & \textbf{Contents description} \\ \hline
   0 &  4 & Magic string `TARE' \\
   4 &  4 & Version number of the block `1'. \\
   8 &  4 & Length of the block excluding magic string, version, and length. \\
  12 &  2 & Width of a tile of the surface. \\
  14 &  2 & Change in Z height (in pixels) when going up or down a tile level. \\
  16 & 72 & Tile surface sprite sub-block. \\ \hline
  88 & \multicolumn{2}{l|}{Total length} \\ \hline
\end{tabular}
\end{center}


\subsection{Patrol area selection}
\begin{center}
\begin{tabular}{|r|c|l|} \hline
\textbf{Offset} & \textbf{Length} & \textbf{Contents description} \\ \hline
   0 &  4 & Magic string `PARE' \\
   4 &  4 & Version number of the block `1'. \\
   8 &  4 & Length of the block excluding magic string, version, and length. \\
  12 &  2 & Width of a tile of the surface. \\
  14 &  2 & Change in Z height (in pixels) when going up or down a tile level. \\
  16 & 72 & Tile surface sprite sub-block. \\ \hline
  88 & \multicolumn{2}{l|}{Total length} \\ \hline
\end{tabular}
\end{center}


\subsection{Tile corner selection block}
\begin{center}
\begin{tabular}{|r|c|l|} \hline
\textbf{Offset} & \textbf{Length} & \textbf{Contents description} \\ \hline
   0 &  4 & Magic string `TCOR' \\
   4 &  4 & Version number of the block `1'. \\
   8 &  4 & Length of the block excluding magic string, version, and length. \\
  12 &  2 & Width of a tile of the surface. \\
  14 &  2 & Change in Z height (in pixels) when going up or down a tile level. \\
  16 & 72 & Tile surface sprite sub-block for selected corner pointing north. \\
  88 & 72 & Tile surface sprite sub-block for selected corner pointing east. \\
 160 & 72 & Tile surface sprite sub-block for selected corner pointing south. \\
 232 & 72 & Tile surface sprite sub-block for selected corner pointing west. \\ \hline
 304 & \multicolumn{2}{l|}{Total length} \\ \hline
\end{tabular}
\end{center}


\subsection{Shops/stalls}
One tile objects.

\begin{center}
\begin{tabular}{|r|c|l|} \hline
\textbf{Offset} & \textbf{Length} & \textbf{Contents description} \\ \hline
   0 &  4 & Magic string `SHOP' \\
   4 &  4 & Version number of the block `1'. \\
   8 &  4 & Length of the block excluding magic string, version, and length. \\
  12 &  2 & Width of a tile of the surface. \\
  14 &  2 & Height of the shop in voxels. \\
  16 &  4 & View to the north where the entrance is at the NE edge. \\
  20 &  4 & View to the north where the entrance is at the SE edge. \\
  24 &  4 & View to the north where the entrance is at the SW edge. \\
  28 &  4 & View to the north where the entrance is at the NW edge. \\ \hline
  32 & \multicolumn{2}{l|}{Total length} \\ \hline
\end{tabular}
\end{center}


\subsection{Build direction arrows}
\begin{center}
\begin{tabular}{|r|c|l|} \hline
\textbf{Offset} & \textbf{Length} & \textbf{Contents description} \\ \hline
   0 &  4 & Magic string `BDIR' \\
   4 &  4 & Version number of the block `1'. \\
   8 &  4 & Length of the block excluding magic string, version, and length. \\
  12 &  2 & Width of a tile of the surface. \\
  14 &  4 & Arrow pointing to NE edge. \\
  18 &  4 & Arrow pointing to SE edge. \\
  22 &  4 & Arrow pointing to SW edge. \\
  26 &  4 & Arrow pointing to NW edge. \\ \hline
  30 & \multicolumn{2}{l|}{Total length} \\ \hline
\end{tabular}
\end{center}


%%
%%
%%
\subsection{Foundations block}
Vertical foundations to close gaps in the smooth surface.

\begin{center}
\begin{tabular}{|r|c|l|} \hline
\textbf{Offset} & \textbf{Length} & \textbf{Contents description} \\ \hline
  0 &  4 & Magic string `FUND' \\
  4 &  4 & Version number of the block `1'. \\
  8 &  4 & Length of the block excluding magic string, version, and length. \\
 12 &  2 & Type of foundation. \\
 14 &  2 & Width of a tile. \\
 16 &  2 & Change in Z height of the tiles. \\
 18 &  4 & Vertical south-east foundation, east up, south down. \\
 22 &  4 & Vertical south-east foundation, east down, south up. \\
 26 &  4 & Vertical south-east foundation, east up, south up. \\
 30 &  4 & Vertical south-west foundation, south up, west down. \\
 34 &  4 & Vertical south-west foundation, south down, west up. \\
 38 &  4 & Vertical south-west foundation, south up, west up. \\ \hline
 42 & \multicolumn{2}{l|}{Total length} \\ \hline
\end{tabular}
\end{center}

\medskip
\noindent
Known types of foundation:
\begin{itemize}
\item Empty (0) Reserved, do not use in the RCD{} file.
\item Ground (16)
\item Wood (32)
\item Brick (48)
\end{itemize}

The tile width and z-height are used to ensure the foundations match with the
surface tiles.

\subsection{Path block}
Path coverage is a set of at most 47 flat images. Paths can connect to
neighbouring tiles through four edges, optionally also covering the corner
between two connecting edges.

Starting at offset 14 are the sprite block numbers of each sprite. As normal,
use 0 to denote absence of a sprite. Two letter words in the description
denote an edge connects, one letter words denote the corner is covered.

Besides the maximal 47 flat sprites there are also 4 sprites with one edge raised.

\medskip
\noindent
Known types of path surface:
\begin{itemize}
\item Empty (0) Reserved, do not use in the RCD{} file.
\item Concrete (16)
\end{itemize}

\begin{center}
\begin{tabular}{|r|c|l|} \hline
\textbf{Offset} & \textbf{Length} & \textbf{Contents description} \\ \hline
   0 &  4 & Magic string `PATH' \\
   4 &  4 & Version number of the block `1'. \\
   8 &  4 & Length of the block excluding magic string, version, and length. \\
  12 &  2 & Type of path surface. \\
  14 &  2 & Width of a tile. \\
  16 &  2 & Change in Z height of the tiles. \\
  18 &  4 & - (empty) \\
  22 &  4 & NE \\
  26 &  4 & SE \\
  30 &  4 & NE, SE \\
  34 &  4 & NE, SE, E \\
  38 &  4 & SW \\
  42 &  4 & NE, SW \\
  46 &  4 & SE, SW \\
  50 &  4 & SE, SW, S \\
  54 &  4 & NE, SE, SW \\
  58 &  4 & NE, SE, SW, E \\
  62 &  4 & NE, SE, SW, S \\
  66 &  4 & NE, SE, SW, E, S \\
  70 &  4 & NW \\
  74 &  4 & NE, NW \\
  78 &  4 & NE, NW, N \\
  82 &  4 & NW, SE \\
  86 &  4 & NE, NW, SE \\
  90 &  4 & NE, NW, SE, N \\
  94 &  4 & NE, NW, SE, E \\
  98 &  4 & NE, NW, SE, N, E \\
 102 &  4 & NW, SW \\
 106 &  4 & NW, SW, W \\
 110 &  4 & NE, NW, SW \\
 114 &  4 & NE, NW, SW, N \\
 118 &  4 & NE, NW, SW, W \\
 122 &  4 & NE, NW, SW, N, W \\
 126 &  4 & NW, SE, SW \\
 130 &  4 & NW, SE, SW, S \\
 134 &  4 & NW, SE, SW, W \\
 138 &  4 & NW, SE, SW, S, W \\
 142 &  4 & NE, NW, SE, SW \\
 146 &  4 & NE, NW, SE, SW, N \\
 150 &  4 & NE, NW, SE, SW, E \\
 154 &  4 & NE, NW, SE, SW, N, E \\
 158 &  4 & NE, NW, SE, SW, S \\
 162 &  4 & NE, NW, SE, SW, N, S \\
 166 &  4 & NE, NW, SE, SW, E, S \\
 170 &  4 & NE, NW, SE, SW, N, E, S \\
 174 &  4 & NE, NW, SE, SW, W \\
\multicolumn{3}{|l|}{\textit{Table continued at next page}} \\ \hline
\end{tabular}
\end{center}

\begin{center}
\begin{tabular}{|r|c|l|} \hline
\multicolumn{3}{|l|}{\textit{Path sprites continued}} \\
\textbf{Offset} & \textbf{Length} & \textbf{Contents description} \\ \hline
 178 &  4 & NE, NW, SE, SW, N, W \\
 182 &  4 & NE, NW, SE, SW, E, W \\
 186 &  4 & NE, NW, SE, SW, N, E, W \\
 190 &  4 & NE, NW, SE, SW, S, W \\
 194 &  4 & NE, NW, SE, SW, N, S, W \\
 198 &  4 & NE, NW, SE, SW, E, S, W \\
 202 &  4 & NE, NW, SE, SW, N, E, S, W \\
 206 &  4 & NE edge up. \\
 210 &  4 & NW edge up. \\
 214 &  4 & SE edge up. \\
 218 &  4 & SW edge up. \\ \hline
 222 & \multicolumn{2}{l|}{Length of one view direction.} \\ \hline
\end{tabular}
\end{center}

\subsection{Platforms}
\begin{center}
\begin{tabular}{|r|c|l|} \hline
\textbf{Offset} & \textbf{Length} & \textbf{Contents description} \\ \hline
   0 &  4 & Magic string `PLAT' \\
   4 &  4 & Version number of the block `1'. \\
   8 &  4 & Length of the block excluding magic string, version, and length. \\
  12 &  2 & Width of a tile of the surface. \\
  14 &  2 & Change in Z height (in pixels) when going up or down a tile level. \\
  16 &  2 & Platform type. \\
  18 &  4 & Flat platform for north and south view. \\
  22 &  4 & Flat platform for east and west view. \\
  26 &  4 & Platform is raised at the NE edge. \\
  30 &  4 & Platform is raised at the SE edge. \\
  34 &  4 & Platform is raised at the SW edge. \\
  38 &  4 & Platform is raised at the NW edge. \\ \hline
  42 & \multicolumn{2}{l|}{Total length} \\ \hline
\end{tabular}
\end{center}

Platform type:
\begin{itemize}
\item Empty 0, do not use.
\item Wood 16.
\end{itemize}


\subsection{Platform supports}
-rotation?
-steep slopes?

%%
%%
%%
\newpage
\section{Future}

To consider:
\begin{itemize}
\item Place for the license
\item Author and other information?
\item Readme document?
\item \ldots?
\end{itemize}

To do:
\begin{itemize}
\item (nothing, at the moment)
\end{itemize}

\end{document}

%vim: set spell
